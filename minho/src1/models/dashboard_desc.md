# dashboard.py 코드 상세 분석

이 문서는 `src/models/dashboard.py` 파일의 구조, 기능 및 구현된 대시보드의 세부 로직에 대한 상세한 설명을 담고 있습니다.

## 1. 개요 (Overview)
이 스크립트는 **Streamlit** 프레임워크를 사용하여 구현된 **웹 기반 고객 이탈 관리 대시보드**입니다. 
학습된 CatBoost 모델을 로드하여 고객의 이탈 확률을 실시간으로 예측하고, 이를 바탕으로 위험군을 분류하며, 각 고객에게 맞는 **마케팅 대응 전략(Strategy Plan)**을 자동으로 제안합니다.

## 2. 주요 라이브러리 및 설정
- **Streamlit**: 파이썬 코드로 빠르게 웹 대시보드를 구축하는 UI 프레임워크.
- **Plotly Express / Graph Objects**: 대화형(Interactive) 차트 시각화를 위한 라이브러리.
- **설정**: `st.set_page_config`를 통해 페이지 타이틀과 레이아웃(Wide Mode)을 설정합니다.

## 3. 데이터 및 모델 로드 파이프라인

### 3.1. `load_data()` (`@st.cache_data`)
- **역할**: 대시보드에 표시할 원본 고객 데이터(`train.csv`)를 로드합니다.
- **캐싱**: `@st.cache_data` 데코레이터를 사용하여 새로고침 시 데이터 로드 시간을 단축합니다.

### 3.2. `load_model()` (`@st.cache_resource`)
- **역할**: `save_model.py` 또는 `cb.py`를 통해 저장된 모델 파일과 메타데이터를 로드합니다.
- **파일 구성**:
  - `churn_model.cbm`: CatBoost 학습 모델.
  - `features.pkl`: 모델 학습 시 사용된 피처 이름 리스트 (컬럼 순서 매핑용).
- **캐싱**: `@st.cache_resource`를 통해 무거운 모델 객체를 메모리에 상주시켜 재로딩을 방지합니다.

## 4. 핵심 비즈니스 로직 (Feature Engineering & Strategy)

모델 예측 후, 비즈니스 인사이트를 제공하기 위해 다음과 같은 파생 변수와 로직을 적용합니다.

### 4.1. 위험 지표 산출
- **Probability (이탈 확률)**: 모델의 `predict_proba()` 결과값.
- **Risk Level (위험 등급) 분류**:
  - `Safe` (🟢): 0% ~ 40%
  - `Attention` (🟡): 40% ~ 70%
  - `Warning` (🟠): 70% ~ 85%
  - `Critical` (🔴): 85% 초과
- **Risk Value (기대 손실액)**: `월 총 요금(Total Bill) × 이탈 확률`로 계산하여, 이탈 시 잃게 될 예상 매출을 수치화합니다.

### 4.2. 대응 전략 자동 배정 (`assign_strategy`)
고객의 상태에 따라 최적의 마케팅 액션을 **우선순위 기반**으로 자동 할당합니다.

1.  **🚨 VIP 전담 케어 (Top Priority)**
    - 조건: `이탈확률 ≥ 85%` AND `요금 상위 20%`
    - 목적: 고가치 고객의 이탈 방지 (Revenue Protection).
2.  **📞 불만 전담 마크**
    - 조건: `고객센터 전화 ≥ 3회`
    - 목적: 누적된 불만 해소 (Churn Prevention).
3.  **🌍 국제전화 요금제 제안**
    - 조건: `국제전화 요금 상위 20%` AND `전용 플랜 미가입`
    - 목적: 맞춤형 상품 제안을 통한 만족도 제고 (Upselling).
4.  **💰 요금 할인 쿠폰 발송**
    - 조건: `요금 상위 30%` AND `이탈확률 > 75%` (Warning 이상)
    - 목적: 가격 민감도(Price Sensitivity)가 높은 이탈 위험군 방어.
5.  **일반 유지 관리**: 위 조건에 해당하지 않는 나머지 고객.

## 5. UI 구성 (Dashboard Layout)

대시보드는 크게 세 가지 섹션으로 구성됩니다.

### A. 핵심 현황 (KPI Board)
- **주요 지표**: 총 관리 고객 수, 집중 관리 대상(Warning+), 총 기대 손실액.
- **ROI 시뮬레이션**: 사이드바의 슬라이더(`예상 이탈 개선율`)를 조절하면, 캠페인 집행 시 **방어 가능한 예상 매출액(ROI)**이 실시간으로 계산되어 표시됩니다.

### B. 시각화 (Charts)
- **위험 등급 분포 (Pie Chart)**: 전체 고객 중 위험군(Critical/Warning)의 비중을 한눈에 파악.
- **전략 유형 분포 (Bar Chart)**: 현재 어떤 마케팅 액션이 가장 많이 필요한지 파악 (리소스 배분용).

### C. 실전 마케팅 리스트 (Actionable Table)
- **필터링 기능**: 특정 위험 등급이나 특정 전략 대상자만 골라볼 수 있는 `MultiSelect` 필터 제공.
- **데이터 테이블**: 마케터가 바로 활용할 수 있도록 정제된 리스트(위험 등급, 확률, 요금, 전략 등)를 표시.
- **CSV 다운로드**: 필터링된 리스트를 엑셀/CSV로 다운로드하여 이메일 발송이나 콜센터 전달 등에 바로 활용 가능.

## 요약
`dashboard.py`는 단순한 대시보드를 넘어, **"누구를(Who), 왜(Why), 어떻게(How) 관리해야 하는가"**에 대한 해답을 데이터를 통해 자동으로 제시해주는 **액션 중심(Action-Oriented) 분석 도구**입니다.
